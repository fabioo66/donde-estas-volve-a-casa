<div class="flex min-h-screen bg-gray-50 font-display text-gray-800">
  <!-- Sidebar -->
  <aside class="w-64 bg-white flex-shrink-0 flex flex-col justify-between p-4 border-r border-gray-200">
    <div class="flex flex-col gap-8">
      <!-- Logo -->
      <div class="flex items-center gap-2 px-2">
        <span class="material-symbols-outlined text-primary text-3xl">pets</span>
        <h1 class="text-xl font-bold text-gray-900">¬øDonde estas? Volve a casa</h1>
      </div>

      <!-- Navigation -->
      <nav class="flex flex-col gap-2">
        <a routerLink="/dashboard" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/10 text-primary">
          <span class="material-symbols-outlined fill">dashboard</span>
          <span class="text-sm font-medium">Dashboard</span>
        </a>
        <a routerLink="/mascota/nuevo" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 hover:text-primary transition-colors">
          <span class="material-symbols-outlined">add_circle</span>
          <span class="text-sm font-medium">Publicar Mascota</span>
        </a>
        <a routerLink="/mis-publicaciones" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 hover:text-primary transition-colors">
          <span class="material-symbols-outlined">description</span>
          <span class="text-sm font-medium">Mis Publicaciones</span>
        </a>
        <a routerLink="/reportar-avistamiento/:id" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 hover:text-primary transition-colors">
          <span class="material-symbols-outlined">location_on</span>
          <span class="text-sm font-medium">Reportar Avistamiento</span>
        </a>
        <a routerLink="/perfil" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 hover:text-primary transition-colors">
          <span class="material-symbols-outlined">person</span>
          <span class="text-sm font-medium">Perfil</span>
        </a>
      </nav>
    </div>

    <!-- Logout button -->
    <div class="flex flex-col">
      <button (click)="logout()" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 hover:text-primary transition-colors">
        <span class="material-symbols-outlined">logout</span>
        <span class="text-sm font-medium">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-8">
    <h2 class="text-3xl font-bold text-gray-900 mb-8">Dashboard</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <p class="text-sm font-medium text-gray-500">Mascotas Perdidas</p>
        <p class="text-4xl font-bold text-gray-900 mt-2" *ngIf="!isLoadingStats && stats">{{ stats?.mascotasPerdidas }}</p>
        <div class="mt-2" *ngIf="isLoadingStats">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        </div>
      </div>
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <p class="text-sm font-medium text-gray-500">Recuperadas</p>
        <p class="text-4xl font-bold text-gray-900 mt-2" *ngIf="!isLoadingStats && stats">{{ stats?.recuperadas }}</p>
        <div class="mt-2" *ngIf="isLoadingStats">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        </div>
      </div>
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <p class="text-sm font-medium text-gray-500">Adoptadas</p>
        <p class="text-4xl font-bold text-gray-900 mt-2" *ngIf="!isLoadingStats && stats">{{ stats?.adoptadas }}</p>
        <div class="mt-2" *ngIf="isLoadingStats">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        </div>
      </div>
      <div class="bg-white p-6 rounded-lg border border-gray-200">
        <p class="text-sm font-medium text-gray-500">Seguimientos Pendientes</p>
        <p class="text-4xl font-bold text-gray-900 mt-2" *ngIf="!isLoadingStats && stats">{{ stats?.seguimientosPendientes }}</p>
        <div class="mt-2" *ngIf="isLoadingStats">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        </div>
      </div>
    </div>

    <!-- My Publications Section -->
    <div>
      <h3 class="text-2xl font-bold text-gray-900 mb-6">Mascotas Perdidas Recientemente</h3>

      <!-- Loading state -->
      <div *ngIf="isLoading" class="flex items-center justify-center py-8">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
        <p class="ml-4 text-gray-600">Cargando mascotas...</p>
      </div>

      <!-- Error state -->
      <div *ngIf="error && !isLoading" class="bg-red-100 border border-red-300 text-red-700 px-4 py-3 rounded mb-8">
        {{ error }}
      </div>

      <!-- Mascotas Content -->
      <div *ngIf="!isLoading && !error">
        <!-- Empty state (when no mascotas) -->
        <div *ngIf="mascotasPerdidas.length === 0" class="bg-white border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center p-16 text-center">
          <div class="mb-4">
            <span class="material-symbols-outlined text-6xl text-gray-400">
              pets
            </span>
          </div>
          <h4 class="text-lg font-bold text-gray-900">No hay mascotas perdidas en este momento</h4>
          <p class="text-sm text-gray-500 max-w-md mt-2 mb-6">En este momento no hay mascotas perdidas reportadas. Revisa m√°s tarde o ayuda publicando si conoces de alguna.</p>
          <button (click)="irAPublicarMascota()" class="bg-primary text-white font-bold text-sm py-2 px-6 rounded-lg hover:bg-opacity-90 transition-colors">
            Publicar Mascota
          </button>
        </div>

        <!-- Mascotas grid (when there are mascotas) -->
        <div *ngIf="mascotasPerdidas.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div
            *ngFor="let mascota of mascotasPerdidas.slice(0, 6)"
            class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow"
          >
            <!-- Image with carousel -->
            <div class="relative h-48 bg-gray-200">
              <img
                [src]="obtenerImagenMascota(mascota)"
                [alt]="mascota.nombre"
                class="w-full h-full object-cover"
              />

              <!-- Navigation buttons for multiple photos -->
              <div *ngIf="obtenerFotos(mascota).length > 1" class="absolute inset-0 flex items-center justify-between p-2">
                <button
                  (click)="anteriorFoto(mascota)"
                  class="bg-black bg-opacity-50 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-opacity-70"
                >
                  ‚Äπ
                </button>
                <button
                  (click)="siguienteFoto(mascota)"
                  class="bg-black bg-opacity-50 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-opacity-70"
                >
                  ‚Ä∫
                </button>
              </div>

              <!-- Photo indicators -->
              <div *ngIf="obtenerFotos(mascota).length > 1" class="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1">
                <div
                  *ngFor="let foto of obtenerFotos(mascota); let i = index"
                  class="w-2 h-2 rounded-full"
                  [class.bg-white]="i === (fotoActualPorMascota.get(mascota.id) || 0)"
                  [class.bg-gray-400]="i !== (fotoActualPorMascota.get(mascota.id) || 0)"
                ></div>
              </div>
            </div>

            <!-- Content -->
            <div class="p-4">
              <h5 class="font-semibold text-gray-900 text-lg mb-2">{{ mascota.nombre }}</h5>
              <p class="text-sm text-gray-600 mb-2">{{ mascota.tipo || 'Mascota' }}</p>
              <p class="text-sm text-gray-500 mb-3 line-clamp-2">{{ mascota.descripcion || 'Sin descripci√≥n disponible' }}</p>

              <!-- Action buttons -->
              <div class="flex gap-2">
                <button
                  (click)="reportarAvistamiento(mascota.id)"
                  class="flex-1 bg-primary text-white text-sm px-3 py-2 rounded hover:bg-primary/90 transition-colors"
                  title="Reportar avistamiento"
                >
                  üìç Reportar Avistamiento
                </button>
              </div>
            </div>
          </div>

          <!-- See more card if there are more than 6 mascotas -->
          <div *ngIf="mascotasPerdidas.length > 6" class="bg-gray-100 rounded-lg shadow border border-gray-200 flex items-center justify-center">
            <button routerLink="/mascotas" class="text-center p-4">
              <span class="material-symbols-outlined text-2xl text-gray-600 mb-2 block">add</span>
              <p class="text-sm text-gray-600">Ver todas ({{ mascotasPerdidas.length }})</p>
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
